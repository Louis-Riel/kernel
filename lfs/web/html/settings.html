<div class="system-config">
    <div class="site-header">
        <h1>Config</h1>
    </div>
    <form action="/status/system" method="post">
        <fieldset class="status">
            <legend>Status</legend>
            <label>
                Up Time
                <input type="timespan" name="uptime" >
            </label>
            <label>
                Sleep Time
                <input type="timespan" name="sleeptime" >
            </label>
        </fieldset>
        <fieldset class="sdcard">
            <legend>SD Card</legend>
            <label>
                MISO Pin
                <input type="number" name="MisoPin">
            </label>
            <label>
                MOSI Pin
                <input type="number" name="MosiPin">
            </label>
            <label>
                Clock Pin
                <input type="number" name="ClkPin">
            </label>
            <label>
                CS Pin
                <input type="number" name="CsPin">
            </label>
        </fieldset>
        <fieldset class="gps">
            <legend>GPS</legend>
            <label>
                RX Pin
                <input type="number" name="rxPin">
            </label>
            <label>
                TX Pin
                <input type="number" name="txPin">
            </label>
            <label>
                Enable Pin
                <input type="number" name="enPin">
            </label>
            <fieldset class="syncpoints">
                <legend>Sync Points</legend>
            </fieldset>
        </fieldset>
        <button>Save</button>
    </form>
    <script>
        fetch('/status/system')
            .then(data => {
                data.json().then(jdata => {
                    document.getElementsByName("uptime")[0].value = jdata.uptime;
                    document.getElementsByName("sleeptime")[0].value = jdata.sleeptime;
                });
            }).catch(error => {
                console.error(error);
            });
        fetch('/config')
            .then(data => {
                data.json().then(jdata => {
                    document.getElementsByName("MisoPin")[0].value = jdata.sdcard.MisoPin;
                    document.getElementsByName("MosiPin")[0].value = jdata.sdcard.MosiPin;
                    document.getElementsByName("ClkPin")[0].value = jdata.sdcard.ClkPin;
                    document.getElementsByName("CsPin")[0].value = jdata.sdcard.CsPin;
                    document.getElementsByName("enPin")[0].value = jdata.gps.enPin;
                    document.getElementsByName("rxPin")[0].value = jdata.gps.rxPin;
                    document.getElementsByName("txPin")[0].value = jdata.gps.txPin;
                    document.querySelector("fieldset.gps").classList.add(jdata.gps.state);
                    document.querySelector("fieldset.sdcard").classList.add(jdata.sdcard.state);
                    for (pos in jdata.gps.pois || []) {
                        document.getElementsByName(`syncpoints[${pos}].lat`)[0].value = jdata.gps.pois[pos].lat;
                        document.getElementsByName(`syncpoints[${pos}].lng`)[0].value = jdata.gps.pois[pos].lng;
                    }
                });
            }).catch(error => {
                console.error(error);
            });
    </script>
</div>